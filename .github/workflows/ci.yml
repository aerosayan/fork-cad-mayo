name: CI

on: [push]

jobs:
    ci:
        strategy:
            fail-fast: false
            matrix:
                os: [windows-latest, ubuntu-latest, macos-latest]
                occ_version: [package]
                include:
                    - os: windows-latest
                      occ_version: 7.4.0
                    - os: windows-latest
                      occ_version: 7.5.0
                    - os: windows-latest
                      occ_version: 7.6.0
                exclude:
                    - os: windows-latest
                      occ_version: package

        runs-on: ${{matrix.os}}

        steps:
        - name: Checkout
          uses: actions/checkout@v3
          with:
              path: 'source'
              fetch-depth: 0
              lfs: false

        - name: Cache Qt
          id: cache-qt
          uses: actions/cache@v1
          with:
              path: ../Qt
              key: ${{ runner.os }}-QtCache

        - name: Install Qt
          uses: jurplel/install-qt-action@v2
          with:
              cached: ${{ steps.cache-qt.outputs.cache-hit }}

        - name: Install OpenCascade[Ubuntu]
          if: startsWith(matrix.os, 'ubuntu')
          run: |
              sudo apt-get -y install libocct-data-exchange-dev libocct-draw-dev
              GH_CASCADE_INC_DIR=`dpkg -L libocct-foundation-dev | grep -i "Standard_Version.hxx" | sed "s/\/Standard_Version.hxx//i"`
              GH_CASCADE_LIB_DIR=`dpkg -L libocct-foundation-dev | grep -i "libTKernel.so" | sed "s/\/libTKernel.so//i"`
              echo "GH_CASCADE_INC_DIR=$GH_CASCADE_INC_DIR" >> $GITHUB_ENV
              echo "GH_CASCADE_LIB_DIR=$GH_CASCADE_LIB_DIR" >> $GITHUB_ENV
